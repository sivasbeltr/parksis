<div id="asamalar-tab" class="tab-content">
    <div class="space-y-2">
        <!-- Mevcut A≈üamalar -->
        {% for asama in gorev.asamalar.all %}
        <div class="bg-gradient-to-r 
            {% if asama.durum == 'tamamlandi' %}from-green-50 to-emerald-50 border-green-200{% elif asama.durum == 'devam_ediyor' %}from-blue-50 to-cyan-50 border-blue-200{% elif asama.durum == 'beklemede' %}from-yellow-50 to-amber-50 border-yellow-200{% else %}from-gray-50 to-gray-100 border-gray-200{% endif %}
            border rounded-lg p-3 hover:shadow transition-all duration-200">
            <div class="flex items-start justify-between gap-2">
                <div class="flex-1">
                    <div class="flex items-center gap-2 mb-2">
                        <!-- Numaralƒ± Badge -->
                        <div class="w-6 h-6 
                            {% if asama.durum == 'tamamlandi' %}bg-green-500{% elif asama.durum == 'devam_ediyor' %}bg-blue-500{% elif asama.durum == 'beklemede' %}bg-yellow-500{% else %}bg-gray-400{% endif %} 
                            text-white rounded-full flex items-center justify-center text-xs font-bold">
                            {{ forloop.counter }}
                        </div>
                        
                        <h4 class="font-semibold text-gray-900 text-base">{{ asama.ad }}</h4>
                        
                        <!-- Modern Durum Badge -->
                        <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-semibold
                            {% if asama.durum == 'tamamlandi' %}bg-green-100 text-green-800 border border-green-200{% elif asama.durum == 'devam_ediyor' %}bg-blue-100 text-blue-800 border border-blue-200{% elif asama.durum == 'beklemede' %}bg-yellow-100 text-yellow-800 border border-yellow-200{% else %}bg-gray-100 text-gray-800 border border-gray-200{% endif %}">
                            {% if asama.durum == 'tamamlandi' %}
                                <i class="fas fa-check mr-1"></i>
                            {% elif asama.durum == 'devam_ediyor' %}
                                <i class="fas fa-play mr-1"></i>
                            {% elif asama.durum == 'beklemede' %}
                                <i class="fas fa-clock mr-1"></i>
                            {% else %}
                                <i class="fas fa-pause mr-1"></i>
                            {% endif %}
                            {{ asama.get_durum_display }}
                        </span>
                    </div>
                    
                    {% if asama.aciklama %}
                    <p class="text-gray-700 mb-2 ml-8 bg-white/60 p-2 rounded text-xs">{{ asama.aciklama }}</p>
                    {% endif %}
                    
                    <div class="ml-8 flex flex-wrap items-center gap-3 text-xs">
                        {% if asama.sorumlu %}
                        <div class="flex items-center gap-1 text-gray-600">
                            <i class="fas fa-user text-emerald-500"></i>
                            <span class="font-medium">{{ asama.sorumlu.ad }}</span>
                        </div>
                        {% endif %}
                        
                        {% if asama.baslangic_tarihi %}
                        <div class="flex items-center gap-1 text-gray-600">
                            <i class="fas fa-calendar-plus text-blue-500"></i>
                            <span>{{ asama.baslangic_tarihi|date:"d.m.Y H:i" }}</span>
                        </div>
                        {% endif %}
                        
                        {% if asama.tamamlanma_tarihi %}
                        <div class="flex items-center gap-1 text-gray-600">
                            <i class="fas fa-calendar-check text-green-500"></i>
                            <span>{{ asama.tamamlanma_tarihi|date:"d.m.Y H:i" }}</span>
                        </div>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Durum Deƒüi≈ütir Dropdown -->
                <div class="flex items-center gap-1">
                    <form method="post" action="{% url 'istakip:gorev_asama_durum_degistir' asama.uuid %}" class="inline">
                        {% csrf_token %}
                        <select name="durum" onchange="this.form.submit()" 
                                class="px-2 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 bg-white">
                            <option value="beklemede" {% if asama.durum == 'beklemede' %}selected{% endif %}>‚è≥ Beklemede</option>
                            <option value="baslamadi" {% if asama.durum == 'baslamadi' %}selected{% endif %}>‚è∏Ô∏è Ba≈ülamadƒ±</option>
                            <option value="devam_ediyor" {% if asama.durum == 'devam_ediyor' %}selected{% endif %}>üîÑ Devam Ediyor</option>
                            <option value="tamamlandi" {% if asama.durum == 'tamamlandi' %}selected{% endif %}>‚úÖ Tamamlandƒ±</option>
                        </select>
                    </form>
                </div>
            </div>
        </div>
        {% empty %}
        <div class="text-center py-8 text-gray-500">
            <div class="w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-2">
                <i class="fas fa-tasks text-xl text-gray-400"></i>
            </div>
            <h3 class="text-base font-medium text-gray-900 mb-1">Hen√ºz a≈üama eklenmemi≈ü</h3>
            <p class="text-gray-600 mb-2 text-xs">G√∂revinizi a≈üamalara b√∂lerek takip etmeyi kolayla≈ütƒ±rƒ±n</p>
            <button onclick="openAsamaModal()" class="inline-flex items-center px-3 py-1.5 bg-emerald-600 text-white rounded hover:bg-emerald-700 text-xs">
                <i class="fas fa-plus mr-1"></i>ƒ∞lk A≈üamayƒ± Ekle
            </button>
        </div>
        {% endfor %}
        
        <!-- Yeni A≈üama Ekleme Butonu -->
        {% if gorev.asamalar.all and gorev.durum != 'tamamlandi' %}
        <div class="border-t border-gray-200 pt-3">
            <button onclick="openAsamaModal()" class="w-full py-2 px-3 border-2 border-dashed border-gray-300 rounded-lg text-gray-600 hover:border-emerald-500 hover:text-emerald-600 hover:bg-emerald-50 transition font-medium text-xs">
                <i class="fas fa-plus mr-1"></i>Yeni A≈üama Ekle
            </button>
        </div>
        {% endif %}
    </div>
</div>
